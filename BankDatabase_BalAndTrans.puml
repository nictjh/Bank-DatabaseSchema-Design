@startuml BankDatabase_BalAndTrans
!theme plain
skinparam entityStyle rectangle

entity "accounts" as accounts {
  *account_id : UUID <<PK>>
}

entity "balances" as balances {
  *balance_id : UUID <<PK>>
  account_id : UUID <<FK>>
  balance_type : TEXT
  amount : NUMERIC(18,2)
  currency : CHAR(3)
  credit_debit : TEXT
  reference_date : DATE
  created_at : TIMESTAMPTZ
}

note right of balances
** Insert a new row everytime to ensure audit trail of balance changes. **

Balance Types:
1. ClosingAvailable : End of day available balance
2. ClosingBooked : End of day booked balance
3. OpeningAvailable : Balance carried into start of day
4. InterimAvailable : Real-time available balance, during the day
https://www.iso20022.org/standardsrepository/type/BalanceTypeCode

At midnight (or end of banking day):
- Insert ClosingBooked balance per account.
- Insert ClosingAvailable balance per account.
- Next day 00:01, insert OpeningAvailable.
end note

entity "transactions" as transactions {
  *transaction_id : UUID <<PK>>
  account_id : UUID <<FK>>
  booking_datetime : TIMESTAMPTZ
  value_datetime : TIMESTAMPTZ
  amount : NUMERIC(18,2)
  currency : CHAR(3)
  credit_debit : TEXT
  transaction_type : TEXT
  description : TEXT
  merchant_name : TEXT
  merchant_category_code : CHAR(4)
  uetr : UUID
  status : TEXT
  created_at : TIMESTAMPTZ
}

accounts ||--o{ balances : "has"
accounts ||--o{ transactions : "records"

@enduml